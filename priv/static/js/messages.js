// Generated by CoffeeScript 1.7.1
(function() {
  var app;

  app = angular.module("ChatterMessages", []);

  app.factory("socket", function() {
    return new Phoenix.Socket('/sockets');
  });

  app.controller("MessagesController", [
    'socket', '$scope', '$cookies', function(socket, $scope, $cookies) {
      var topic;
      $scope.messages = [];
      $scope.users = [];
      $scope.newMessage = {};
      topic = "Lobby";
      return socket.join('broadcast', topic, {
        sender_name: $cookies.sender_name
      }, function(channel) {
        channel.on('join', function(response) {
          $scope.topic = topic;
          $scope.messages = response.messages;
          $scope.users = response.active_users;
          return $scope.$digest();
        });
        channel.on('receive', function(message) {
          $scope.messages.push(message);
          return $scope.$digest();
        });
        channel.on('user:joined', function(message) {
          _.pull($scope.users, message.sender_name).push(message.sender_name);
          return $scope.$digest();
        });
        channel.on('user:left', function(message) {
          _.pull($scope.users, message.sender_name);
          return $scope.$digest();
        });
        return $scope.sendMessage = function(message) {
          channel.send('send', $scope.newMessage);
          return $scope.newMessage = {};
        };
      });
    }
  ]);

  app.directive("message", function() {
    return {
      templateUrl: 'partials/message.html',
      restrict: 'E'
    };
  });

}).call(this);

//# sourceMappingURL=messages.map
